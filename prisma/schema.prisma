generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int            @id @default(autoincrement())
  name          String
  email         String         @unique
  password      String
  isActive      Boolean
  createdAt     DateTime       @default(now())
  organizations Organization[]
  approved      Boolean        @default(false)
}

model Organization {
  id            Int            @id @default(autoincrement())
  name          String
  email         String         @unique
  password      String
  isActive      Boolean
  owner         User           @relation(fields: [ownerId], references: [id])
  ownerId       Int
  sales         Sale[]
  collaborators Collaborator[]
  goals         Goal[]
  createdAt     DateTime       @default(now())
  approved      Boolean        @default(false)
  Channel       Channel[]
}

model Sale {
  id             Int          @id @default(autoincrement())
  month          DateTime // Armazena apenas mês/ano
  investment     Float // Valor investido
  revenue        Float // Faturamento
  leadsGenerated Int // Quantidade de leads gerados
  salesCount     Int // Número de vendas
  productsSold   Int // Quantidade de produtos vendidos
  channel        Channel      @relation(fields: [channelId], references: [id]) // Relacionamento opcional com Canal
  channelId      Int
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId Int
  createdAt      DateTime     @default(now())
  Goal           Goal[]
}

model Collaborator {
  id                    Int                     @id @default(autoincrement())
  name                  String
  organization          Organization            @relation(fields: [organizationId], references: [id])
  organizationId        Int
  createdAt             DateTime                @default(now())
  items                 CollaboratorItem[]
  Goal                  Goal[]
  ChannelToCollaborator ChannelToCollaborator[]
}

model CollaboratorItem {
  id             Int          @id @default(autoincrement())
  leadsGenerated Int // Quantidade de leads gerados
  salesCount     Int // Número de vendas realizadas
  productsSold   Int // Quantidade de produtos vendidos
  revenue        Float // Faturamento
  investedAmount Float // Valor investido
  channelId      Int?
  channel        Channel?     @relation(fields: [channelId], references: [id])
  collaborator   Collaborator @relation(fields: [collaboratorId], references: [id])
  collaboratorId Int
  createdAt      DateTime     @default(now())
}

model Goal {
  id               Int          @id @default(autoincrement())
  goalType         GoalType // Tipo de Meta: Vendas ou Colaborador
  valorInvestido   Float // Valor Investido
  faturamento      Float // Faturamento
  ledsGerados      Int // Quantidade de LEDs Gerados
  numeroVendas     Int // Número de Vendas
  produtosVendidos Int // Quantidade de Produtos Vendidos
  mesMeta          DateTime
  organization     Organization @relation(fields: [organizationId], references: [id])
  organizationId   Int // Relacionamento com a organização que possui essa meta
  channel          Channel?     @relation(fields: [channelId], references: [id]) // Relacionamento opcional com Canal
  channelId        Int?

  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @default(now()) @updatedAt
  Sale           Sale?         @relation(fields: [saleId], references: [id])
  saleId         Int?
  Collaborator   Collaborator? @relation(fields: [collaboratorId], references: [id])
  collaboratorId Int?
}

enum GoalType {
  COLLABORATOR
  SALES
}

model Channel {
  id                    Int                     @id @default(autoincrement())
  name                  String
  organization          Organization            @relation(fields: [organizationId], references: [id])
  organizationId        Int
  ChannelToCollaborator ChannelToCollaborator[]
  CollaboratorItem      CollaboratorItem[]
  Goal                  Goal[]
  Sale                  Sale[]
}

model ChannelToCollaborator {
  id             Int          @id @default(autoincrement())
  month          DateTime // Armazena o mês/ano
  leadsGenerated Int // Quantidade de leads gerados nesse canal pelo colaborador
  salesCount     Int // Número de vendas realizadas nesse canal pelo colaborador
  productsSold   Int // Quantidade de produtos vendidos nesse canal pelo colaborador
  revenue        Float // Faturamento gerado nesse canal pelo colaborador
  channel        Channel      @relation(fields: [channelId], references: [id])
  channelId      Int
  collaborator   Collaborator @relation(fields: [collaboratorId], references: [id])
  collaboratorId Int
  createdAt      DateTime     @default(now())
}
